# TMB calculation

# configfile: 'config.yaml'

rule all:
    input:
        'processed_data/mut_at_CCDS.vcf'

rule fix_maf_space:
    input: 'data/mc3.v0.2.8.PUBLIC.maf'
    output: 'processed_data/mc3.maf'
    message: 'Changing line breaks of the MAF file'
    shell: 'perl -lne \'s/\\r//; print "$_";\' {input} > {output}'

rule maf_to_vcf:
    input:
        mut_file='processed_data/mc3.maf',
        ref_file='data/Homo_sapiens.GRCh37.75.dna.primary_assembly.fa'
    output: 'processed_data/mc3.vcf'
    message: 'Converting maf file to vcf format'
    shell: 'perl workflow/maf2vcf.pl --input-maf {input.mut_file} --output-dir processed_data --ref-fasta {input.ref_file}'

rule ccds_format:
    input: 'data/CCDS.20131129.txt'
    output: 'processed_data/CCDS.bed'
    message: 'Making a BED file from exon coordinates'
    shell: 'cut -f1,8,9 {input} > {output}'

rule find_intersect:
    input:
        vcf_file='processed_data/mc3.vcf',
        CCDS_file='processed_data/CCDS.bed'
    output: 'processed_data/mut_at_CCDS.vcf'
    shell: 'bedtools intersect -wa -a {input.vcf_file} -b {input.CCDS_file} > {output}'
